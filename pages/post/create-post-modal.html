<!-- Create Post Modal -->
<div class="modal-overlay" id="createPostModal">
  <div class="modal-container">
    <!-- Header -->
    <div class="modal-header">
      <button class="modal-back-btn" onclick="handleBackButton()">
        <i data-lucide="arrow-left"></i>
      </button>
      <h2 class="modal-title" id="modalTitle">Upload and Edit Photos</h2>
      <button
        class="modal-next-btn"
        id="modalActionBtn"
        onclick="handleNextStep()"
      >
        Next
      </button>
    </div>

    <!-- Step 1: Upload & Edit -->
    <div class="modal-content" id="step1Content">
      <!-- Media Preview Area -->
      <div class="post-media-container step1-media">
        <!-- Default Placeholder -->
        <div class="media-placeholder" id="mediaPlaceholder">
          <div class="placeholder-icon">
            <i data-lucide="image"></i>
          </div>
          <p class="placeholder-text">Upload photos here</p>
          <button class="select-btn" onclick="triggerMediaUpload()">
            Upload
          </button>
        </div>

        <!-- Media Preview (hidden by default) -->
        <div
          class="media-preview-wrapper"
          id="mediaPreviewWrapper"
          style="display: none"
        >
          <div class="media-zoom-container" id="mediaZoomContainer">
            <div class="media-content-wrapper" id="mediaContentWrapper">
              <img
                id="postImagePreview"
                src=""
                alt="Preview"
                style="display: none"
              />
              <video
                id="postVideoPreview"
                controls
                style="display: none"
              ></video>
            </div>

            <!-- Crop Overlay -->
            <div class="crop-overlay" id="cropOverlay">
              <div class="crop-frame" id="cropFrameEl"></div>
            </div>
          </div>

          <!-- Zoom Controls - Vertical on Right -->
          <div class="zoom-controls" id="zoomControls">
            <button class="zoom-btn" onclick="zoomIn()" title="Zoom in">
              <i data-lucide="zoom-in"></i>
            </button>
            <div class="zoom-slider" id="zoomSlider">
              <div class="zoom-slider-track" id="zoomSliderTrack">
                <div class="zoom-slider-thumb" id="zoomSliderThumb"></div>
              </div>
            </div>
            <button class="zoom-btn" onclick="zoomOut()" title="Zoom out">
              <i data-lucide="zoom-out"></i>
            </button>
          </div>

          <!-- Media Thumbnails with + button -->
          <div class="media-thumbnails" id="mediaThumbnails">
            <!-- Thumbnails will be dynamically added here -->
          </div>
        </div>

        <input
          type="file"
          id="postMediaInput"
          accept="image/*"
          style="display: none"
          onchange="handleMediaUpload(event)"
          multiple
        />
      </div>

      <!-- Right Panel for Step 1 - Crop Info -->
      <div class="post-details-panel step1-panel">
        <div class="crop-info-panel">
          <div class="crop-info-header">
            <i
              data-lucide="crop"
              style="width: 24px; height: 24px; color: var(--accent-primary)"
            ></i>
            <h3>Crop Ratio</h3>
          </div>
          <p class="crop-info-desc">
            Choose a ratio that fits the aesthetic of your post. <br />
            1:1 (Square) is recommended for most feeds.
          </p>

          <div class="crop-ratio-grid">
            <button
              class="crop-ratio-card active"
              data-ratio="1:1"
              onclick="changeCropRatio('1:1')"
            >
              <div class="ratio-preview ratio-1-1"></div>
              <span>1:1</span>
            </button>
            <button
              class="crop-ratio-card"
              data-ratio="4:5"
              onclick="changeCropRatio('4:5')"
            >
              <div class="ratio-preview ratio-4-5"></div>
              <span>4:5</span>
            </button>
            <button
              class="crop-ratio-card"
              data-ratio="16:9"
              onclick="changeCropRatio('16:9')"
            >
              <div class="ratio-preview ratio-16-9"></div>
              <span>16:9</span>
            </button>
            <button
              class="crop-ratio-card"
              data-ratio="original"
              onclick="changeCropRatio('original')"
            >
              <div class="ratio-preview ratio-original"></div>
              <span>Original</span>
            </button>
          </div>

          <div class="step1-help">
            <div class="help-item">
              <i
                data-lucide="alert-circle"
                style="width: 20px; height: 20px"
              ></i>
              <div>
                <strong>Important Reminder</strong>
                <p>
                  After changing the crop ratio, check all images to ensure
                  they're properly cropped
                </p>
              </div>
            </div>
            <div class="help-item">
              <i data-lucide="info" style="width: 20px; height: 20px"></i>
              <div>
                <strong>Image Details</strong>
                <p id="imageResolution">No file selected</p>
              </div>
            </div>
            <div class="help-item">
              <i
                data-lucide="help-circle"
                style="width: 20px; height: 20px"
              ></i>
              <div>
                <strong>Help & Shortcuts</strong>
                <p>Scroll to zoom â€¢ Click and drag to pan</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 2: Add Details -->
    <div class="modal-content" id="step2Content" style="display: none">
      <!-- Media Preview Area (Read-only) -->
      <div class="post-media-container step2-media">
        <div class="media-preview-readonly" id="mediaPreviewReadonly">
          <div class="media-readonly-container" id="mediaReadonlyContainer">
            <div class="media-slider-wrapper" id="mediaSliderWrapper">
              <!-- Slider track will be built dynamically -->
            </div>
          </div>

          <!-- Navigation for multiple images -->
          <div
            class="media-navigation"
            id="mediaNavigation"
            style="display: none"
          >
            <button class="nav-btn prev-btn" onclick="previousImage()">
              <i data-lucide="chevron-left"></i>
            </button>
            <button class="nav-btn next-btn" onclick="nextImage()">
              <i data-lucide="chevron-right"></i>
            </button>
          </div>

          <!-- Media Thumbnails for Step 2 -->
          <div class="media-thumbnails" id="mediaThumbnailsStep2">
            <!-- Thumbnails will be dynamically added here -->
          </div>
        </div>
      </div>

      <!-- Right Panel for Step 2 - Details -->
      <div class="post-details-panel">
        <!-- User Info with Privacy Selector -->
        <div class="create-post-user-info">
          <img id="post-user-avatar" src="" alt="avatar" class="user-avatar" />
          <div class="user-info-details">
            <span id="post-user-name" class="user-name">User</span>
            <div
              class="privacy-selector"
              onclick="togglePrivacyDropdown(event)"
            >
              <i data-lucide="globe" class="privacy-icon" id="privacyIcon"></i>
              <span class="privacy-text" id="privacyText">Public</span>
              <i data-lucide="chevron-right" class="privacy-chevron"></i>
            </div>
          </div>
        </div>

        <!-- Privacy Dropdown -->
        <div class="privacy-dropdown" id="privacyDropdown">
          <div
            class="privacy-option active"
            data-privacy="0"
            onclick="selectPrivacy(0)"
          >
            <div class="privacy-option-left">
              <i data-lucide="globe"></i>
              <div>
                <span class="privacy-option-title">Public</span>
                <span class="privacy-option-desc"
                  >Anyone can see this post</span
                >
              </div>
            </div>
            <i data-lucide="check" class="privacy-check"></i>
          </div>
          <div
            class="privacy-option"
            data-privacy="1"
            onclick="selectPrivacy(1)"
          >
            <div class="privacy-option-left">
              <i data-lucide="users"></i>
              <div>
                <span class="privacy-option-title">Followers Only</span>
                <span class="privacy-option-desc"
                  >Only your followers can see</span
                >
              </div>
            </div>
            <i data-lucide="check" class="privacy-check"></i>
          </div>
          <div
            class="privacy-option"
            data-privacy="2"
            onclick="selectPrivacy(2)"
          >
            <div class="privacy-option-left">
              <i data-lucide="lock"></i>
              <div>
                <span class="privacy-option-title">Private</span>
                <span class="privacy-option-desc"
                  >Only you can see this post</span
                >
              </div>
            </div>
            <i data-lucide="check" class="privacy-check"></i>
          </div>
        </div>

        <!-- Caption Input -->
        <div class="post-caption-container">
          <textarea
            id="postCaption"
            class="post-caption-input"
            placeholder="Write a caption..."
            oninput="updateCharCount()"
          ></textarea>
          <div class="post-caption-tools">
            <div class="char-count">
              <span id="charCount">0</span>/<span id="maxCharCount"></span>
            </div>
            <button
              type="button"
              class="post-caption-emoji-btn"
              onclick="toggleEmojiPicker(event)"
              aria-label="Add emoji"
            >
              <i data-lucide="smile-plus"></i>
            </button>
            <!-- Emoji Picker Container -->
            <div
              id="emojiPickerContainer"
              class="post-emoji-picker-container"
            ></div>
          </div>
        </div>

        <!-- Location Section -->
        <div class="post-section">
          <div class="section-header" onclick="toggleSection('location')">
            <div class="section-left">
              <i data-lucide="map-pin" class="section-icon"></i>
              <span class="section-title">Add Location</span>
            </div>
            <i data-lucide="chevron-right" class="chevron-icon"></i>
          </div>
          <div
            class="section-content"
            id="locationContent"
            style="display: none"
          >
            <input
              type="text"
              class="location-input"
              placeholder="Search location..."
            />
          </div>
        </div>

        <!-- Collaborators Section -->
        <div class="post-section">
          <div class="section-header" onclick="toggleSection('collaborators')">
            <div class="section-left">
              <i data-lucide="users" class="section-icon"></i>
              <span class="section-title">Tag People / Collaborators</span>
            </div>
            <i data-lucide="chevron-right" class="chevron-icon"></i>
          </div>
          <div
            class="section-content"
            id="collaboratorsContent"
            style="display: none"
          >
            <input
              type="text"
              class="collaborator-input"
              placeholder="Search users..."
            />
          </div>
        </div>

        <!-- Accessibility Section -->
        <div class="post-section">
          <div class="section-header" onclick="toggleSection('accessibility')">
            <div class="section-left">
              <i data-lucide="accessibility" class="section-icon"></i>
              <span class="section-title">Accessibility</span>
            </div>
            <i data-lucide="chevron-right" class="chevron-icon"></i>
          </div>
          <div
            class="section-content"
            id="accessibilityContent"
            style="display: none"
          >
            <p class="section-helper-text">
              Alt text describes your photos for people with visual impairments.
            </p>
            <textarea
              class="alt-text-input"
              placeholder="Write alt text..."
              maxlength="500"
            ></textarea>
          </div>
        </div>

        <!-- Advanced Settings -->
        <div class="post-section">
          <div class="section-header" onclick="toggleSection('advanced')">
            <div class="section-left">
              <i data-lucide="sliders" class="section-icon"></i>
              <span class="section-title">Advanced Settings</span>
            </div>
            <i data-lucide="chevron-right" class="chevron-icon"></i>
          </div>
          <div
            class="section-content advanced-settings"
            id="advancedContent"
            style="display: none"
          >
            <!-- Turn off commenting -->
            <div class="setting-item">
              <div class="setting-info">
                <i
                  data-lucide="message-circle-off"
                  class="setting-icon-only"
                ></i>
                <div class="setting-details">
                  <span class="setting-name">Turn off commenting</span>
                  <span class="setting-desc"
                    >People won't be able to comment on this post</span
                  >
                </div>
              </div>
              <div class="toggle-switch" id="commentToggle">
                <div class="toggle-slider"></div>
              </div>
            </div>

            <!-- Hide like and view counts -->
            <div class="setting-item">
              <div class="setting-info">
                <i data-lucide="eye-off" class="setting-icon-only"></i>
                <div class="setting-details">
                  <span class="setting-name">Hide like and view counts</span>
                  <span class="setting-desc"
                    >Only you will see the total number of likes and views</span
                  >
                </div>
              </div>
              <div class="toggle-switch" id="hideCountsToggle">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Load Emoji Mart from CDN -->
<script type="module">
  import { Picker } from "https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js";

  // Register the picker and make it available globally
  window.EmojiPicker = Picker;

  // Also define the custom element if needed
  if (!customElements.get("em-emoji-picker")) {
    customElements.define("em-emoji-picker", Picker);
  }
</script>
