<!-- Create Post Modal -->
<div class="modal-overlay" id="createPostModal">
  <div class="modal-container">
    <!-- Header -->
    <div class="modal-header">
      <button class="modal-back-btn" onclick="handleBackButton()">
        <i data-lucide="arrow-left"></i>
      </button>
      <h2 class="modal-title" id="modalTitle">Upload and Edit Photos/Videos</h2>
      <button
        class="modal-next-btn"
        id="modalActionBtn"
        onclick="handleNextStep()"
      >
        Next
      </button>
    </div>

    <!-- Step 1: Upload & Edit -->
    <div class="modal-content" id="step1Content">
      <!-- Media Preview Area -->
      <div class="post-media-container step1-media">
        <!-- Default Placeholder -->
        <div class="media-placeholder" id="mediaPlaceholder">
          <div class="placeholder-icon">
            <i data-lucide="image"></i>
            <i data-lucide="video"></i>
          </div>
          <p class="placeholder-text">Upload photos and videos here</p>
          <button class="select-btn" onclick="triggerMediaUpload()">
            Upload
          </button>
        </div>

        <!-- Media Preview (hidden by default) -->
        <div
          class="media-preview-wrapper"
          id="mediaPreviewWrapper"
          style="display: none"
        >
          <div class="media-zoom-container" id="mediaZoomContainer">
            <div class="media-content-wrapper" id="mediaContentWrapper">
              <img
                id="postImagePreview"
                src=""
                alt="Preview"
                style="display: none"
              />
              <video
                id="postVideoPreview"
                controls
                style="display: none"
              ></video>
            </div>

            <!-- Crop Overlay -->
            <div class="crop-overlay" id="cropOverlay">
              <div class="crop-frame" id="cropFrameEl"></div>
            </div>
          </div>

          <!-- Zoom Controls - Vertical on Right -->
          <div class="zoom-controls" id="zoomControls">
            <button class="zoom-btn" onclick="zoomIn()" title="Zoom in">
              <i data-lucide="zoom-in"></i>
            </button>
            <div class="zoom-slider" id="zoomSlider">
              <div class="zoom-slider-track" id="zoomSliderTrack">
                <div class="zoom-slider-thumb" id="zoomSliderThumb"></div>
              </div>
            </div>
            <button class="zoom-btn" onclick="zoomOut()" title="Zoom out">
              <i data-lucide="zoom-out"></i>
            </button>
          </div>

          <!-- Media Thumbnails with + button -->
          <div class="media-thumbnails" id="mediaThumbnails">
            <!-- Thumbnails will be dynamically added here -->
          </div>
        </div>

        <input
          type="file"
          id="postMediaInput"
          accept="image/*,video/*"
          style="display: none"
          onchange="handleMediaUpload(event)"
          multiple
        />
      </div>

      <!-- Right Panel for Step 1 - Crop Info -->
      <div class="post-details-panel step1-panel">
        <div class="crop-info-panel">
          <div class="crop-info-header">
            <i
              data-lucide="crop"
              style="width: 24px; height: 24px; color: var(--accent-primary)"
            ></i>
            <h3>Crop Ratio</h3>
          </div>
          <p class="crop-info-desc">
            Choose a ratio that fits the aesthetic of your post. <br />
            1:1 (Square) is recommended for most feeds.
          </p>

          <div class="crop-ratio-grid">
            <button
              class="crop-ratio-card active"
              data-ratio="1:1"
              onclick="changeCropRatio('1:1')"
            >
              <div class="ratio-preview ratio-1-1"></div>
              <span>1:1</span>
            </button>
            <button
              class="crop-ratio-card"
              data-ratio="4:5"
              onclick="changeCropRatio('4:5')"
            >
              <div class="ratio-preview ratio-4-5"></div>
              <span>4:5</span>
            </button>
            <button
              class="crop-ratio-card"
              data-ratio="16:9"
              onclick="changeCropRatio('16:9')"
            >
              <div class="ratio-preview ratio-16-9"></div>
              <span>16:9</span>
            </button>
            <button
              class="crop-ratio-card"
              data-ratio="original"
              onclick="changeCropRatio('original')"
            >
              <div class="ratio-preview ratio-original"></div>
              <span>Original</span>
            </button>
          </div>

          <div class="step1-help">
            <div class="help-item">
              <i data-lucide="info" style="width: 20px; height: 20px"></i>
              <div>
                <strong>Media Details</strong>
                <p id="imageResolution">No file selected</p>
              </div>
            </div>
            <div class="help-item">
              <i
                data-lucide="help-circle"
                style="width: 20px; height: 20px"
              ></i>
              <div>
                <strong>Help & Shortcuts</strong>
                <p>Scroll to zoom • Click and drag to pan</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 2: Add Details -->
    <div class="modal-content" id="step2Content" style="display: none">
      <!-- Media Preview Area (Read-only) -->
      <div class="post-media-container step2-media">
        <div class="media-preview-readonly" id="mediaPreviewReadonly">
          <div class="media-readonly-container" id="mediaReadonlyContainer">
            <div class="media-slider-wrapper" id="mediaSliderWrapper">
              <!-- Slider track will be built dynamically -->
            </div>
          </div>

          <!-- Navigation for multiple images -->
          <div
            class="media-navigation"
            id="mediaNavigation"
            style="display: none"
          >
            <button class="nav-btn prev-btn" onclick="previousImage()">
              <i data-lucide="chevron-left"></i>
            </button>
            <button class="nav-btn next-btn" onclick="nextImage()">
              <i data-lucide="chevron-right"></i>
            </button>
          </div>

          <!-- Media Thumbnails for Step 2 -->
          <div class="media-thumbnails" id="mediaThumbnailsStep2">
            <!-- Thumbnails will be dynamically added here -->
          </div>
        </div>
      </div>

      <!-- Right Panel for Step 2 - Details -->
      <div class="post-details-panel">
        <!-- User Info -->
        <div class="post-user-info">
          <img id="post-user-avatar" src="" alt="avatar" class="user-avatar" />
          <div>
            <span id="post-user-name" class="user-name">User</span>
            <span class="user-visibility">Public Post</span>
          </div>
        </div>

        <!-- Caption Input -->
        <div class="post-caption-container">
          <textarea
            id="postCaption"
            class="post-caption-input"
            placeholder="Write a caption..."
            maxlength="2200"
            oninput="updateCharCount()"
          ></textarea>
          <div class="char-count"><span id="charCount">0</span>/2200</div>
        </div>

        <!-- Emoji Button -->
        <button class="emoji-btn" onclick="toggleEmojiPicker()">
          <i data-lucide="smile"></i>
        </button>

        <!-- Location Section -->
        <div class="post-section">
          <div class="section-header" onclick="toggleSection('location')">
            <div class="section-left">
              <i data-lucide="map-pin" class="section-icon"></i>
              <span class="section-title">Add Location</span>
            </div>
            <i data-lucide="chevron-right" class="chevron-icon"></i>
          </div>
          <div
            class="section-content"
            id="locationContent"
            style="display: none"
          >
            <input
              type="text"
              class="location-input"
              placeholder="Search location..."
            />
          </div>
        </div>

        <!-- Collaborators Section -->
        <div class="post-section">
          <div class="section-header" onclick="toggleSection('collaborators')">
            <div class="section-left">
              <i data-lucide="users" class="section-icon"></i>
              <span class="section-title">Tag People / Collaborators</span>
            </div>
            <i data-lucide="chevron-right" class="chevron-icon"></i>
          </div>
          <div
            class="section-content"
            id="collaboratorsContent"
            style="display: none"
          >
            <input
              type="text"
              class="collaborator-input"
              placeholder="Search users..."
            />
          </div>
        </div>

        <!-- Accessibility Section -->
        <div class="post-section">
          <div class="section-header" onclick="toggleSection('accessibility')">
            <div class="section-left">
              <i data-lucide="accessibility" class="section-icon"></i>
              <span class="section-title">Accessibility</span>
            </div>
            <i data-lucide="chevron-down" class="chevron-icon"></i>
          </div>
          <div
            class="section-content"
            id="accessibilityContent"
            style="display: none"
          >
            <p class="section-helper-text">
              Alt text describes your photos for people with visual impairments.
            </p>
            <textarea
              class="alt-text-input"
              placeholder="Write alt text..."
              maxlength="500"
            ></textarea>
          </div>
        </div>

        <!-- Advanced Settings -->
        <div class="post-section">
          <div class="section-header" onclick="toggleSection('advanced')">
            <span class="section-title">Advanced Settings</span>
            <i data-lucide="chevron-down" class="chevron-icon"></i>
          </div>
          <div
            class="section-content advanced-settings"
            id="advancedContent"
            style="display: none"
          >
            <!-- Share to Threads -->
            <div class="setting-item">
              <div class="setting-info">
                <img
                  src="https://via.placeholder.com/32/5B51D8/FFFFFF?text=T"
                  alt="Threads"
                  class="platform-icon"
                />
                <div class="setting-details">
                  <span class="setting-name">nmin301</span>
                  <span class="setting-desc">Threads • Public</span>
                </div>
              </div>
              <div class="toggle-switch active">
                <div class="toggle-slider"></div>
              </div>
            </div>

            <!-- Share to Facebook -->
            <div class="setting-item">
              <div class="setting-info">
                <img
                  src="https://via.placeholder.com/32/1877F2/FFFFFF?text=F"
                  alt="Facebook"
                  class="platform-icon"
                />
                <div class="setting-details">
                  <span class="setting-name">Dang Nhat Minh</span>
                  <span class="setting-desc">Facebook • Only me</span>
                </div>
              </div>
              <div class="toggle-switch">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
